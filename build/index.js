(()=>{"use strict";var e,a={199:()=>{const e=window.wp.blocks,a=window.wp.i18n,n=window.wp.blockEditor,o=window.wp.components,t=window.wp.element,i=window.wp.data,l=window.ReactJSXRuntime,r=JSON.parse('{"UU":"create-block/pollination-ai-image-block"}');(0,e.registerBlockType)(r.UU,{edit:function({setAttributes:r,clientId:s}){const[c,d]=(0,t.useState)(!1),[p,g]=(0,t.useState)(""),[m,h]=(0,t.useState)(""),[u,b]=(0,t.useState)(""),{insertBlock:k}=(0,i.useDispatch)(n.store),{innerBlocks:w}=(0,i.useSelect)((e=>({innerBlocks:e(n.store).getBlocks(s)})),[s]),_=()=>{g(""),h(""),b(""),d(!1)};return(0,l.jsxs)("div",{...(0,n.useBlockProps)(),children:[!w.length&&(0,l.jsxs)("div",{className:"form-container",children:[(0,l.jsx)(o.TextareaControl,{rows:3,label:(0,a.__)("Prompt Text","pollination-ai-image-block"),value:p||"",help:`${(0,a.__)("Characters left:","pollination-ai-image-block")} ${475-p.length}`,disabled:!!c,onChange:e=>{(e=>{e.length<=475&&g(e)})(e)}}),!m&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.Button,{className:"is-primary",disabled:!!c,onClick:()=>(async()=>{if(d(!0),p)try{const e=await fetch(`https://image.pollinations.ai/prompt/${encodeURIComponent(p)}?nologo=true`,{method:"GET"}),a=await e.blob(),n=URL.createObjectURL(a);h(n)}catch(e){b(`<strong>${(0,a.__)("Error generating image:","pollination-ai-image-block")}</strong><br/> ${e}`)}finally{d(!1)}else d(!1)})(),children:c?(0,a.__)("Loadingâ€¦","pollination-ai-image-block"):(0,a.__)("Generate Image","pollination-ai-image-block")}),c&&(0,l.jsx)(o.Spinner,{})]}),""!==m&&(0,l.jsxs)("div",{className:"buttons-row",children:[(0,l.jsx)(o.Button,{className:"is-primary",onClick:()=>{d(!0),fetch(m).then((e=>e.blob())).then((n=>{const o=new window.FileReader;o.onloadend=function(){const n=o.result.split(",")[1];wp.ajax.send("pollination_ai_image_block_save_image",{data:{prompt_text:p,image_data:n,nonce:aiMediaGenerator.nonce},success(a){r({generatedImageId:a.attachment_id,generatedImageURL:a.url,promptText:p});const n=(0,e.createBlock)("core/image",{id:a.attachment_id,sizeSlug:"large",url:a.url});k(n,w.length,s),d(!1),_()},error(e){b(`<strong>${(0,a.__)("Error saving image:","pollination-ai-image-block")}</strong><br/> ${e}`)},finally(){d(!1)}})},o.readAsDataURL(n)}))},children:(0,a.__)("Save and insert","pollination-ai-image-block")}),(0,l.jsx)(o.Button,{className:"is-secondary",onClick:()=>{_()},children:(0,a.__)("Cancel","pollination-ai-image-block")})]}),u&&(0,l.jsx)("div",{className:"has-error",dangerouslySetInnerHTML:{__html:u}}),""!==m&&(0,l.jsx)("img",{src:m,width:"100%",height:"auto",alt:"",className:"generated-image"})]}),(0,l.jsx)(n.InnerBlocks,{allowedBlocks:["core/image"],renderAppender:!1})]})},save:function(){return(0,l.jsx)("div",{...n.useBlockProps.save(),children:(0,l.jsx)(n.InnerBlocks.Content,{templateLock:"all"})})}})}},n={};function o(e){var t=n[e];if(void 0!==t)return t.exports;var i=n[e]={exports:{}};return a[e](i,i.exports,o),i.exports}o.m=a,e=[],o.O=(a,n,t,i)=>{if(!n){var l=1/0;for(d=0;d<e.length;d++){for(var[n,t,i]=e[d],r=!0,s=0;s<n.length;s++)(!1&i||l>=i)&&Object.keys(o.O).every((e=>o.O[e](n[s])))?n.splice(s--,1):(r=!1,i<l&&(l=i));if(r){e.splice(d--,1);var c=t();void 0!==c&&(a=c)}}return a}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[n,t,i]},o.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),(()=>{var e={57:0,350:0};o.O.j=a=>0===e[a];var a=(a,n)=>{var t,i,[l,r,s]=n,c=0;if(l.some((a=>0!==e[a]))){for(t in r)o.o(r,t)&&(o.m[t]=r[t]);if(s)var d=s(o)}for(a&&a(n);c<l.length;c++)i=l[c],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return o.O(d)},n=globalThis.webpackChunkpollination_ai_image_block=globalThis.webpackChunkpollination_ai_image_block||[];n.forEach(a.bind(null,0)),n.push=a.bind(null,n.push.bind(n))})();var t=o.O(void 0,[350],(()=>o(199)));t=o.O(t)})();